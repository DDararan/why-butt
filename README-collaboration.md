# TTT Wiki 실시간 동시편집 기능 가이드

## 개요
TTT Wiki는 Docmost의 실시간 협업 편집 기능을 참고하여 구현한 동시편집 시스템입니다.
여러 사용자가 동시에 하나의 문서를 편집할 수 있으며, 실시간으로 변경사항이 동기화됩니다.

## 기술 스택

### Backend
- Spring Boot (Java)
- H2 Database
- RESTful API

### Frontend
- React (TypeScript)
- TipTap Editor (ProseMirror 기반)
- Material-UI

### 실시간 동기화
- Hocuspocus (WebSocket 서버)
- Yjs (CRDT 라이브러리)
- y-websocket (WebSocket Provider)

## 실행 방법

### Windows
```bash
# 프로젝트 루트에서
start-all.bat
```

### Linux/Mac
```bash
# 프로젝트 루트에서
chmod +x start-all.sh
./start-all.sh
```

### 수동 실행

1. **백엔드 서버 시작**
   ```bash
   ./gradlew bootRun
   ```

2. **Hocuspocus 서버 시작**
   ```bash
   cd frontend
   npm run hocuspocus
   ```

3. **프론트엔드 서버 시작**
   ```bash
   cd frontend
   npm start
   ```

## 주요 기능

### 1. 실시간 협업 편집
- 여러 사용자가 동시에 문서 편집
- 실시간 커서 위치 표시
- 사용자별 색상 구분
- 선택 영역 하이라이트

### 2. 연결 상태 표시
- 연결됨 (초록색)
- 연결 중 (주황색)
- 연결 끊김 (빨간색)

### 3. 온라인 사용자 표시
- 현재 문서를 편집 중인 사용자 목록
- 사용자별 아바타 및 이름 표시

### 4. 편집 기능
- 텍스트 서식 (굵게, 기울임, 밑줄 등)
- 제목 레벨 (H1, H2, H3)
- 리스트 (글머리 기호, 번호, 체크리스트)
- 테이블 편집
- 코드 블록
- 이미지 삽입
- 링크 추가

## 테스트 시나리오

### 기본 동작 테스트
1. http://localhost:3000 접속
2. 사용자 로그인
3. 새 페이지 생성 또는 기존 페이지 수정
4. 편집 내용이 자동 저장되는지 확인

### 동시편집 테스트
1. 두 개의 브라우저 창 열기 (예: Chrome + Chrome Incognito)
2. 각각 다른 사용자로 로그인
3. 동일한 페이지의 수정 화면 접속
4. 다음 항목 확인:
   - 다른 사용자의 커서가 보이는지
   - 실시간으로 편집 내용이 동기화되는지
   - 연결 상태가 올바르게 표시되는지
   - 온라인 사용자 목록이 업데이트되는지

### 충돌 해결 테스트
1. 두 사용자가 동시에 같은 위치 편집
2. Yjs의 CRDT 알고리즘이 자동으로 충돌 해결
3. 모든 사용자에게 일관된 결과 표시

## 문제 해결

### WebSocket 연결 실패
- Hocuspocus 서버가 실행 중인지 확인 (포트 1234)
- 브라우저 콘솔에서 연결 오류 확인
- 방화벽 설정 확인

### 동기화 오류
- 브라우저 새로고침 후 재시도
- 서버 로그 확인 (Hocuspocus 콘솔)
- 네트워크 연결 상태 확인

### 커서가 보이지 않음
- 다른 사용자가 실제로 편집 중인지 확인
- CollaborationCursor extension 로드 확인
- 사용자 색상이 올바르게 설정되었는지 확인

## 아키텍처

```
┌─────────────┐     ┌─────────────┐     ┌─────────────┐
│   Browser   │     │   Browser   │     │   Browser   │
│  (User A)   │     │  (User B)   │     │  (User C)   │
└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
       │                   │                   │
       └───────────────────┴───────────────────┘
                           │
                    WebSocket (ws://)
                           │
                  ┌────────▼────────┐
                  │   Hocuspocus    │
                  │  (WebSocket)    │
                  │   Port: 1234    │
                  └────────┬────────┘
                           │
                      HTTP API
                           │
                  ┌────────▼────────┐
                  │  Spring Boot    │
                  │   Backend API   │
                  │   Port: 8181    │
                  └────────┬────────┘
                           │
                  ┌────────▼────────┐
                  │  H2 Database    │
                  │   (In-Memory)   │
                  └─────────────────┘
```

## 보안 고려사항

- 현재는 데모용 간단한 토큰 인증 사용
- 프로덕션 환경에서는 JWT 또는 OAuth2 구현 필요
- WebSocket 연결 시 토큰 검증 강화 필요
- HTTPS 및 WSS 프로토콜 사용 권장

## 향후 개선사항

1. **오프라인 지원**
   - IndexedDB를 활용한 로컬 저장
   - 네트워크 복구 시 자동 동기화

2. **성능 최적화**
   - 대용량 문서 처리
   - 많은 수의 동시 사용자 지원

3. **추가 기능**
   - 버전 관리 및 히스토리
   - 댓글 및 주석 기능
   - 실시간 음성/화상 통화
   - 문서 잠금 기능

4. **UI/UX 개선**
   - 사용자별 커서 애니메이션
   - 더 나은 충돌 표시
   - 편집 권한 관리

## 라이선스
이 프로젝트는 학습 및 데모 목적으로 개발되었습니다.